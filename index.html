<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HyperEVM Real-Time Trading - TOKEN/WHYPE</title>
    <!-- Balance Fix Version: 2025-08-10-17:30 -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.4/dist/ethers.umd.min.js"></script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .container {
            max-width: 375px;
            margin: 0 auto;
            min-height: 100vh;
            background: #000;
            padding-top: 90px;
            display: flex;
            flex-direction: column;
        }
        
        /* Header Section */
        .header {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            max-width: 375px;
            margin: 0 auto;
            background: #000;
            z-index: 90;
            border-bottom: 1px solid #222;
        }
        
        .token-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .token-pair {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dropdown-arrow {
            font-size: 12px;
            color: #666;
        }
        
        .price-change {
            color: #00ff88;
            font-size: 14px;
            font-weight: 600;
        }
        
        .header-controls {
            display: flex;
            gap: 8px;
        }
        
        .header-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #00ff88;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .connect-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #00ff88;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .connect-btn:hover {
            background: #333;
            border-color: #00ff88;
        }
        
        .connect-btn.connected {
            background: #00ff88;
            color: #000;
            border-color: #00ff88;
        }
        
        .chart-section {
            height: 280px;
            background: #000;
            position: relative;
            margin: 0 16px 16px 16px;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid #1a1a1a;
        }
        

        
        .chart-header {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 12px 16px 8px 16px;
            border-bottom: 1px solid #1a1a1a;
            background: #0a0a0a;
        }
        
        .timeframe-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .timeframe-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #999;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 28px;
            text-align: center;
        }
        
        .timeframe-btn:hover {
            background: #333;
            color: #fff;
        }
        
        .timeframe-btn.active {
            background: #00ff88;
            color: #000;
            border-color: #00ff88;
        }
        
        .chart-info {
            font-size: 11px;
            color: #666;
            font-weight: 500;
        }
        
        .chart-container {
            position: relative;
            height: 220px;
            background: #0a0a0a;
            margin: 0;
            display: flex;
            overflow: hidden;
            border: 1px solid #1a1a1a;
        }
        
        .price-labels {
            display: none;
        }
        
        .price-label {
            font-size: 10px;
            color: #666;
            text-align: right;
            line-height: 1.2;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
            font-weight: 400;
        }
        
        .price-label.current {
            color: #00ff88;
            font-weight: 500;
            background: rgba(0, 255, 136, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
            margin: -2px -4px;
        }
        
        #candlestickContainer {
            flex: 1;
            height: 100%;
            position: relative;
            padding: 10px 70px 30px 10px;
            background: #131722;
            /* TEMPORARILY DISABLE GRID PATTERN TO SHOW CANDLESTICKS CLEARLY */
            /* background-image: 
                linear-gradient(to right, rgba(240, 243, 250, 0.06) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(240, 243, 250, 0.06) 1px, transparent 1px);
            background-size: 30px 25px; */
            user-select: none;
            touch-action: pan-x pan-y;
            border: 1px solid #2a2e39;
            border-radius: 0;
            overflow: hidden;
        }
        
        .candlestick {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: crosshair;
            transition: opacity 0.15s ease;
        }
        
        .candlestick:hover {
            transform: scale(1.05);
            z-index: 5;
        }
        
        .candlestick .top-wick {
            width: 1px;
            background: #666;
            margin: 0;
        }
        
        .candlestick .top-wick.up {
            background: linear-gradient(to bottom, #26a69a, #4db6ac, #00e676);
            box-shadow: 0 0 4px rgba(38, 166, 154, 0.5);
            width: 2px;
        }
        
        .candlestick .top-wick.down {
            background: linear-gradient(to bottom, #ef5350, #e57373, #f44336);
            box-shadow: 0 0 4px rgba(239, 83, 80, 0.5);
            width: 2px;
        }
        
        .candlestick .body {
            width: 8px;
            border: none;
            margin: 0;
            min-height: 2px;
            border-radius: 1px;
        }
        
        .candlestick .body.up {
            background: linear-gradient(135deg, #26a69a 0%, #4db6ac 50%, #00e676 100%);
            border: 2px solid #26a69a;
            box-shadow: 0 0 8px rgba(38, 166, 154, 0.6), inset 0 2px 0 rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }
        
        .candlestick .body.down {
            background: linear-gradient(135deg, #ef5350 0%, #e57373 50%, #f44336 100%);
            border: 2px solid #ef5350;
            box-shadow: 0 0 8px rgba(239, 83, 80, 0.6), inset 0 2px 0 rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }
        
        .candlestick .bottom-wick {
            width: 1px;
            background: #666;
            margin: 0;
        }
        
        .candlestick .bottom-wick.up {
            background: linear-gradient(to bottom, #26a69a, #4db6ac, #00e676);
            box-shadow: 0 0 4px rgba(38, 166, 154, 0.5);
            width: 2px;
        }
        
        .candlestick .bottom-wick.down {
            background: linear-gradient(to bottom, #ef5350, #e57373, #f44336);
            box-shadow: 0 0 4px rgba(239, 83, 80, 0.5);
            width: 2px;
        }
        
        .volume-bars {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 65px;
            height: 40px;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            padding: 5px 10px;
            background: rgba(10, 10, 10, 0.95);
            border-top: 1px solid #1a1a1a;
        }
        
        .volume-bar {
            background: rgba(102, 102, 102, 0.3);
            border-radius: 1px 1px 0 0;
            transition: all 0.2s ease;
            width: 8px;
            min-height: 2px;
        }
        
        .volume-bar.up {
            background: rgba(0, 255, 136, 0.5);
        }
        
        .volume-bar.down {
            background: rgba(255, 71, 87, 0.5);
        }
        
        .chart-current-price {
            display: none;
        }
        
        .chart-times {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 65px;
            height: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            background: rgba(10, 10, 10, 0.95);
            font-size: 9px;
            color: #666;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
            border-top: 1px solid #1a1a1a;
        }
        
        .timeframe-btn.active {
            background: #00ff88;
            color: #000;
            border-color: #00ff88;
        }
        
        .timeframe-btn:hover {
            background: #333;
            color: #fff;
        }
        
        .chart-info {
            font-size: 10px;
            color: #666;
            margin-left: auto;
        }
        
        .chart-container {
            width: 100%;
            height: calc(100% - 50px);
            background: linear-gradient(135deg, #0a0a0a 0%, #121212 50%, #0a0a0a 100%);
            position: relative;
            display: flex;
            align-items: end;
            justify-content: space-between;
            padding: 15px 45px 25px 15px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5), 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .price-labels {
            position: absolute;
            right: 5px;
            top: 15px;
            bottom: 25px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 9px;
            color: #666;
            font-family: 'Courier New', monospace;
            width: 60px;
            pointer-events: none;
            background: rgba(0,0,0,0.7);
            padding: 5px;
            border-left: 1px solid #333;
        }
        
        .price-label {
            text-align: right;
            line-height: 1;
            font-weight: 500;
        }
        
        .price-label.current {
            color: #00ff88;
            font-weight: 600;
            background: rgba(0, 255, 136, 0.1);
            padding: 1px 4px;
            border-radius: 2px;
            border: 1px solid #00ff88;
        }
        
        .candlestick {
            width: 8px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: crosshair;
            transition: opacity 0.2s;
        }
        
        .candlestick:hover {
            opacity: 0.8;
        }
        
        .wick {
            width: 1px;
            background: #333;
            transition: all 0.2s;
        }
        
        .wick.up {
            background: linear-gradient(to bottom, #26a69a, #00e676);
            box-shadow: 0 0 2px rgba(38, 166, 154, 0.3);
        }
        
        .wick.down {
            background: linear-gradient(to bottom, #ef5350, #f44336);
            box-shadow: 0 0 2px rgba(239, 83, 80, 0.3);
        }
        
        .body {
            width: 6px;
            margin: 0;
            border-radius: 1px;
            transition: all 0.2s;
            min-height: 2px;
        }
        
        .body.up {
            background: linear-gradient(135deg, #26a69a, #00e676);
            border: 1px solid #26a69a;
            box-shadow: 0 0 4px rgba(38, 166, 154, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .body.down {
            background: linear-gradient(135deg, #ef5350, #f44336);
            border: 1px solid #ef5350;
            box-shadow: 0 0 4px rgba(239, 83, 80, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .body.doji {
            background: transparent;
            border: 1px solid #999;
            height: 1px !important;
        }
        
        .chart-current-price {
            position: absolute;
            bottom: 8px;
            left: 16px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #00ff88;
            font-weight: 600;
            background: rgba(0, 255, 136, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #00ff88;
        }
        
        .chart-times {
            position: absolute;
            bottom: 5px;
            left: 16px;
            right: 45px;
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: #666;
            font-family: 'Courier New', monospace;
        }
        
        .volume-bars {
            position: absolute;
            bottom: 25px;
            left: 15px;
            right: 45px;
            height: 30px;
            display: flex;
            align-items: end;
            justify-content: space-between;
            opacity: 0.6;
        }
        
        .volume-bar {
            width: 8px;
            background: #333;
            border-radius: 1px 1px 0 0;
            min-height: 2px;
            transition: all 0.2s;
        }
        
        .volume-bar.up {
            background: rgba(0, 255, 136, 0.6);
        }
        
        .volume-bar.down {
            background: rgba(255, 71, 87, 0.6);
        }
        
        /* Trading Controls */
        .controls-row {
            display: flex;
            padding: 0 16px 16px 16px;
            gap: 12px;
            justify-content: space-between;
            align-items: center;
        }
        
        .left-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .right-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .price-change-display {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 8px 12px;
            min-width: 70px;
            text-align: center;
        }
        
        #quantitySymbol {
            transition: all 0.2s ease;
            user-select: none;
            background: none !important;
        }
        
        #quantitySymbol:hover {
            transform: scale(1.1);
            color: #00ff88 !important;
            background: none !important;
        }
        
        .control-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .margin-selector {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        
        .margin-selector:hover {
            background: #222;
        }
        
        .margin-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            z-index: 100;
            margin-top: 2px;
        }
        
        .margin-option {
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-bottom: 1px solid #333;
        }
        
        .margin-option:last-child {
            border-bottom: none;
        }
        
        .margin-option:hover {
            background: #333;
        }
        
        .leverage-selector {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        
        .leverage-selector:hover {
            background: #222;
        }
        
        .leverage-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            z-index: 100;
            margin-top: 2px;
            padding: 16px;
            width: 200px;
        }
        
        .leverage-slider-container {
            margin-bottom: 12px;
        }
        
        .leverage-slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            margin: 8px 0;
            cursor: pointer;
            touch-action: none;
            pointer-events: auto;
        }
        
        .leverage-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 4px rgba(0, 255, 136, 0.5);
        }
        
        .leverage-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 4px rgba(0, 255, 136, 0.5);
        }
        
        .leverage-slider::-moz-range-track {
            background: #333;
            height: 4px;
            border-radius: 2px;
        }
        
        .leverage-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .leverage-display {
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            color: #00ff88;
            margin: 8px 0;
        }
        
        .leverage-quick-options {
            display: flex;
            gap: 8px;
            justify-content: space-between;
        }
        
        .leverage-option {
            flex: 1;
            padding: 6px 8px;
            font-size: 12px;
            cursor: pointer;
            border: 1px solid #333;
            border-radius: 4px;
            text-align: center;
            background: #222;
        }
        
        .leverage-option:hover {
            background: #333;
            border-color: #00ff88;
        }
        

        
        .available-section {
            padding: 0 16px 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .available-text {
            font-size: 13px;
            color: #999;
        }
        
        .available-amount {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }
        
        .funding-info {
            text-align: right;
            font-size: 11px;
            color: #999;
        }
        
        .funding-rate {
            color: #00ff88;
            font-weight: 500;
        }
        
        /* Main Trading Area */
        .trading-section {
            display: flex;
            padding: 0 16px;
            gap: 12px;
            overflow: visible;
            min-height: 0;
            align-items: flex-start;
            height: auto;
            margin-bottom: 16px;
            transition: all 0.3s ease-out;
        }
        
        .left-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            height: auto;
            justify-content: flex-start;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        
        .market-selector {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        
        .market-selector:hover {
            background: #222;
        }
        
        .market-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            z-index: 100;
            margin-top: 2px;
        }
        
        .market-option {
            padding: 10px 12px;
            font-size: 14px;
            cursor: pointer;
            border-bottom: 1px solid #333;
        }
        
        .market-option:last-child {
            border-bottom: none;
        }
        
        .market-option:hover {
            background: #333;
        }
        
        .price-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .price-label {
            font-size: 12px;
            color: #999;
        }
        
        .price-input {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .quantity-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .quantity-label {
            font-size: 12px;
            color: #999;
        }
        
        .quantity-input {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .percentage-slider {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }
        
        .slider-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #333;
        }
        
        .slider-dot.active {
            background: #00ff88;
        }
        
        .slider-dot {
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-size: 8px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .slider-dot:hover {
            background: #555;
            transform: scale(1.2);
        }
        
        .slider-dot:last-child {
            font-size: 7px;
            color: #00ff88;
            background: transparent;
            border: 1px solid #00ff88;
            width: 20px;
            height: 12px;
            border-radius: 6px;
        }
        
        .percentage-slider-container {
            margin: 8px 0;
            position: relative;
        }
        
        .quantity-percentage-slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            cursor: pointer;
            touch-action: none;
        }
        
        .quantity-percentage-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 4px rgba(0, 255, 136, 0.5);
        }
        
        .quantity-percentage-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 4px rgba(0, 255, 136, 0.5);
        }
        
        .quantity-percentage-slider::-moz-range-track {
            background: #333;
            height: 4px;
            border-radius: 2px;
        }
        
        .percentage-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #666;
            margin-top: 4px;
            padding: 0 8px;
        }
        
        .value-section {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 12px;
        }
        
        .value-row {
            display: flex;
            justify-content: space-between;
        }
        
        .value-label {
            color: #999;
        }
        
        .value-amount {
            color: #00ff88;
            font-weight: 500;
        }
        
        .checkboxes {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 12px;
        }
        
        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox {
            width: 16px;
            height: 16px;
            background: #333;
            border: 1px solid #666;
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }
        
        .checkbox.checked {
            background: #00ff88;
            border-color: #00ff88;
        }
        
        .checkbox.checked::after {
            content: '✓';
            position: absolute;
            top: -1px;
            left: 3px;
            color: #000;
            font-size: 10px;
            font-weight: bold;
        }
        
        .tp-sl-section {
            margin: 12px 0;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                margin: 0;
            }
            to {
                opacity: 1;
                max-height: 120px;
                margin: 12px 0;
            }
        }
        
        .tp-sl-inputs {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .tp-input-group, .sl-input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .tp-sl-label {
            font-size: 12px;
            color: #999;
        }
        
        .tp-sl-input {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 8px 10px;
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: auto;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .action-btn {
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }
        
        .long-btn {
            background: #00ff88;
            color: #000;
        }
        
        .short-btn {
            background: #ff4757;
            color: #fff;
        }
        
        /* Order Book */
        .orderbook {
            flex: 1;
            background: transparent;
            padding: 0;
            height: auto;
            overflow: visible;
            display: flex;
            flex-direction: column;
            min-height: 0;
            transition: all 0.3s ease-out;
        }
        
        .orderbook.expanded {
            min-height: 420px;
        }
        
        .expansion-row {
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease-out;
        }
        
        .expansion-row.show {
            opacity: 1;
            transform: translateY(0);
            display: flex !important;
        }
        
        .orderbook-header {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 9px;
            color: #666;
            margin-bottom: 4px;
            text-align: left;
            border-bottom: 1px solid #1a1a1a;
        }
        
        .orderbook-row {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
            font-size: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.4;
            margin: 0;
        }
        
        .price-sell {
            color: #ff4757;
            font-weight: 500;
        }
        
        .price-buy {
            color: #00ff88;
            font-weight: 500;
        }
        
        .quantity {
            color: #999;
            font-weight: 400;
        }
        
        .current-price {
            background: transparent;
            border: none;
            padding: 2px 0;
            text-align: center;
            margin: 2px 0;
        }
        
        .current-price-value {
            font-size: 11px;
            color: #00ff88;
            font-weight: 600;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .tick-size-dropdown {
            margin-top: 8px;
            position: relative;
            flex-shrink: 0;
        }
        
        .tick-size-display {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            padding: 8px;
            border-radius: 3px;
            font-size: 9px;
            width: 100%;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 32px;
            -webkit-tap-highlight-color: rgba(0, 255, 136, 0.1);
            user-select: none;
        }
        
        .tick-size-display:hover {
            background: #2a2a2a;
        }
        
        .tick-size-display:active {
            background: #333;
        }
        
        .tick-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 3px;
            z-index: 1000;
        }
        
        .tick-option {
            padding: 8px;
            font-size: 9px;
            color: #fff;
            cursor: pointer;
            text-align: center;
            min-height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: rgba(0, 255, 136, 0.1);
        }
        
        .tick-option:hover {
            background: #333;
        }
        
        .tick-option:active {
            background: #555;
        }
        

        
        /* Bottom Navigation */
        .bottom-nav {
            background: #0a0a0a;
            border-top: 1px solid #222;
            display: flex;
            padding: 8px 0 8px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 375px;
            margin: 0 auto;
            z-index: 100;
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: #666;
        }
        
        .nav-item.active {
            color: #00ff88;
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
        }
        
        /* Positions Section */
        .positions-section {
            background: #0a0a0a;
            border-top: 1px solid #222;
            margin-top: 20px;
            margin-bottom: 80px;
        }
        
        .positions-header {
            border-bottom: 1px solid #222;
        }
        
        .positions-tabs {
            display: flex;
            padding: 0 16px;
            overflow-x: auto;
            gap: 16px;
        }
        
        .position-tab {
            padding: 12px 8px;
            font-size: 11px;
            color: #666;
            white-space: nowrap;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            min-height: 44px;
            display: flex;
            align-items: center;
            -webkit-tap-highlight-color: rgba(0, 255, 136, 0.1);
        }
        
        .position-tab.active {
            color: #00ff88;
            border-bottom-color: #00ff88;
        }
        
        .positions-content {
            padding: 8px 16px;
            background: #000;
        }
        
        .position-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            min-height: 44px;
            -webkit-tap-highlight-color: rgba(0, 255, 136, 0.1);
        }
        
        .position-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .position-symbol {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }
        
        .position-pnl {
            font-size: 14px;
            font-weight: 600;
        }
        
        .position-pnl.positive {
            color: #00ff88;
        }
        
        .position-pnl.negative {
            color: #ff4757;
        }
        
        .position-details-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .detail-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            min-height: 44px;
            justify-content: center;
            -webkit-tap-highlight-color: rgba(0, 255, 136, 0.1);
        }
        
        .detail-col:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .detail-label {
            font-size: 10px;
            color: #666;
            margin-bottom: 2px;
        }
        
        .detail-value {
            font-size: 12px;
            color: #fff;
            font-weight: 500;
        }
        
        .position-actions-row {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        
        .close-position-btn {
            background: #ff4757;
            color: #fff;
            border: none;
            padding: 8px 16px;
            min-height: 44px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .share-position-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 8px 16px;
            min-height: 44px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Token Selector Modal */
        .token-selector-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .token-selector-content {
            background: #1a1a1a;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow: hidden;
            border: 1px solid #333;
        }
        
        .token-selector-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .token-selector-header h3 {
            color: #fff;
            margin: 0;
            font-size: 18px;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            color: #fff;
        }
        
        .token-search {
            padding: 20px;
            border-bottom: 1px solid #333;
        }
        
        .token-search input {
            width: 100%;
            background: #333;
            border: 1px solid #555;
            color: #fff;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }
        
        .token-search input:focus {
            border-color: #00ff88;
        }
        
        .token-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .token-item {
            padding: 16px 20px;
            border-bottom: 1px solid #2a2a2a;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .token-item:hover {
            background: #2a2a2a;
        }
        
        .token-item:last-child {
            border-bottom: none;
        }
        
        .token-info-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }
        
        .token-symbol {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
        }
        
        .token-name {
            font-size: 12px;
            color: #999;
        }
        
        .token-info-right {
            display: flex;
            flex-direction: column;
            gap: 2px;
            text-align: right;
            align-items: flex-end;
        }
        
        .token-price {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }
        

        
        /* Dynamic Price Line Animation */
        @keyframes moveDots {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 12px 0;
            }
        }
        
        .dynamic-price-line {
            transition: top 0.3s ease-out;
        }
        
        .dynamic-price-label {
            transition: all 0.3s ease-out;
            animation: pulsePriceLabel 2s ease-in-out infinite;
        }
        
        @keyframes pulsePriceLabel {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 4px rgba(0, 255, 136, 0.6);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 8px rgba(0, 255, 136, 0.9);
            }
        }
        
        @keyframes pulsePriceLine {
            0%, 100% {
                opacity: 0.3;
                transform: scaleY(1);
            }
            50% {
                opacity: 0.8;
                transform: scaleY(1.5);
            }
        }
    </style>
</head>
<body>
    <script>
        // Position tab switching functionality
        function switchPositionTab(tabName) {
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.position-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Update content based on selected tab
            const contentDiv = document.querySelector('.positions-content');
            
            if (tabName === 'orders') {
                contentDiv.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 16px;">📋</div>
                        <div style="font-size: 14px; margin-bottom: 8px;">No Open Orders</div>
                        <div style="font-size: 12px;">You have no active orders at this time</div>
                    </div>
                `;
            } else if (tabName === 'assets') {
                // Call the real assets page function instead of showing mock data
                showAssetsPage();
            } else if (tabName === 'positions') {
                // Show real positions data instead of mock data
                updatePositionsDisplay();
            }
        }
        
        function closePosition() {
            alert('Close position functionality would be implemented here');
        }
        
        function sharePosition() {
            alert('Share position functionality would be implemented here');
        }
        
        function togglePositionDetails() {
            // Position row click functionality
            console.log('Position details toggled');
        }
        
        function toggleTickSize() {
            console.log('toggleTickSize clicked');
            const options = document.getElementById('tickOptions');
            const isHidden = options.style.display === 'none' || !options.style.display;
            options.style.display = isHidden ? 'block' : 'none';
            console.log('Dropdown is now:', options.style.display);
        }
        
        function selectTick(value) {
            console.log('selectTick clicked with value:', value);
            document.getElementById('selectedTick').textContent = value;
            document.getElementById('tickOptions').style.display = 'none';
        }
        
        // Market dropdown functionality
        function toggleMarketDropdown() {
            console.log('toggleMarketDropdown clicked');
            const options = document.getElementById('marketOptions');
            const isVisible = options.style.display === 'block';
            options.style.display = isVisible ? 'none' : 'block';
        }
        
        function selectOrderType(type, event) {
            if (event) event.stopPropagation();
            console.log('selectOrderType clicked with type:', type);
            document.getElementById('selectedOrderType').textContent = type;
            document.getElementById('marketOptions').style.display = 'none';
            
            // Show/hide price input based on order type
            const priceLabel = document.getElementById('priceLabel');
            const marketPrice = document.getElementById('marketPrice');
            const entryPrice = document.getElementById('entryPrice');
            
            if (type === 'Limit') {
                priceLabel.textContent = 'Entry Price';
                marketPrice.style.display = 'none';
                entryPrice.style.display = 'block';
            } else {
                priceLabel.textContent = 'Market Price';
                marketPrice.style.display = 'block';
                entryPrice.style.display = 'none';
            }
        }
        
        // Margin dropdown functionality
        function toggleMarginDropdown() {
            console.log('toggleMarginDropdown clicked');
            const options = document.getElementById('marginOptions');
            const isVisible = options.style.display === 'block';
            options.style.display = isVisible ? 'none' : 'block';
        }
        
        function selectMargin(type, event) {
            if (event) event.stopPropagation();
            console.log('selectMargin clicked with type:', type);
            document.getElementById('selectedMargin').textContent = type;
            document.getElementById('marginOptions').style.display = 'none';
        }
        
        // Leverage dropdown functionality
        function toggleLeverageDropdown() {
            console.log('toggleLeverageDropdown clicked');
            const options = document.getElementById('leverageOptions');
            const isVisible = options.style.display === 'block';
            options.style.display = isVisible ? 'none' : 'block';
        }
        
        function updateLeverage(value) {
            console.log('Leverage updated to:', value + 'x');
            document.getElementById('leverageDisplay').textContent = value + 'x';
            document.getElementById('selectedLeverage').textContent = value + 'x';
            // Update trade values with new leverage
            updateTradeValues();
        }
        
        function selectLeverage(value, event) {
            if (event) event.stopPropagation();
            console.log('selectLeverage clicked with value:', value);
            document.getElementById('leverageSlider').value = value;
            document.getElementById('selectedLeverage').textContent = value + 'x';
            document.getElementById('leverageDisplay').textContent = value + 'x';
            document.getElementById('leverageOptions').style.display = 'none';
            // Update trade values with new leverage
            updateTradeValues();
        }
        
        // TP/SL functionality
        function toggleTPSL() {
            const checkbox = document.getElementById('tpslCheckbox');
            const section = document.getElementById('tpslSection');
            const orderbook = document.querySelector('.orderbook');
            const expansionRows = document.querySelectorAll('.expansion-row');
            const isChecked = checkbox.classList.contains('checked');
            
            if (isChecked) {
                checkbox.classList.remove('checked');
                section.style.display = 'none';
                orderbook.classList.remove('expanded');
                
                // Hide additional order book rows with animation
                expansionRows.forEach((row, index) => {
                    setTimeout(() => {
                        row.classList.remove('show');
                        setTimeout(() => {
                            row.style.display = 'none';
                        }, 300);
                    }, index * 50);
                });
            } else {
                checkbox.classList.add('checked');
                section.style.display = 'block';
                orderbook.classList.add('expanded');
                
                // Show additional order book rows with staggered animation
                expansionRows.forEach((row, index) => {
                    setTimeout(() => {
                        row.style.display = 'flex';
                        setTimeout(() => {
                            row.classList.add('show');
                        }, 50);
                    }, index * 100);
                });
            }
        }
        
        // Real-time HyperEVM token data - will be populated by WebSocket
        let tokenData = {};
        let socket = null;
        
        // Initialize WebSocket connection for real-time data
        function initializeWebSocket() {
            try {
                socket = io();
                console.log('Connecting to real-time data stream...');
                
                // Handle initial token data
                socket.on('tokenData', (tokens) => {
                    console.log('Received real-time token data:', tokens.length + ' tokens');
                    updateTokenData(tokens);
                });
                
                // Handle real-time price updates
                socket.on('priceUpdate', (tokens) => {
                    console.log('Received price updates for', tokens.length, 'tokens');
                    updateTokenData(tokens);
                    updateCurrentTokenDisplay();
                    
                    // Update token selector if open
                    const selectorModal = document.getElementById('tokenSelector');
                    if (selectorModal && selectorModal.style.display === 'flex') {
                        populateTokenList();
                    }
                });
                
                // Handle order book updates
                socket.on('orderbookUpdate', (data) => {
                    console.log('Received orderbook update for', data.symbol + '/WHYPE');
                    updateOrderBookDisplay(data.orderbook);
                });
                
                // Handle funding rate updates
                socket.on('fundingRateUpdate', (data) => {
                    console.log('Received funding rate update:', data);
                    updateFundingRateDisplay(data);
                });
                
                // Initialize funding rate display immediately
                updateFundingRateDisplay(null);
                
                // Update funding rate every second for accurate countdown
                setInterval(() => {
                    updateFundingRateDisplay(null);
                }, 1000);
                
                socket.on('connect', () => {
                    console.log('Connected to real-time trading data');
                });
                
                socket.on('disconnect', () => {
                    console.log('Disconnected from trading data stream');
                });
                
                socket.on('error', (error) => {
                    console.error('WebSocket error:', error);
                });
                
            } catch (error) {
                console.error('Failed to initialize WebSocket:', error);
                // Fallback to REST API
                fetchTokenDataREST();
            }
        }
        
        // Update token data from WebSocket
        function updateTokenData(tokens) {
            tokens.forEach(token => {
                tokenData[token.symbol] = {
                    symbol: token.symbol,
                    name: token.name,
                    price: parseFloat(token.price),
                    change: parseFloat(token.change_24h || 0),
                    pair: `${token.symbol}/USD`, // Show USD pairs for better UX
                    volume: token.volume_24h || 0,
                    mcap: token.market_cap || 0,
                    logoUrl: token.logoUrl || `https://hyperswap.ai/tokenLogos/${token.symbol.toLowerCase()}.svg`,
                    timestamp: token.timestamp || Date.now()
                };
            });
            
            console.log('📊 Token data updated:', Object.keys(tokenData).length, 'tokens');
            console.log('BUDDY price check:', tokenData.BUDDY ? `$${tokenData.BUDDY.price.toFixed(8)}` : 'not found');
            
            // Update trading interface with real balance
            updateTradingQuantities();
        }
        
        // Update trading quantities with real wallet balance
        function updateTradingQuantities() {
            if (!walletConnected || !userBalance) return;
            
            // Update all balance displays
            updateAllBalanceDisplays();
            
            // Update percentage slider to work with real balance
            updateQuantityPercentage(75); // Default to 75%
        }
        
        // Fallback REST API function
        async function fetchTokenDataREST() {
            try {
                console.log('Fetching token data via REST API...');
                const response = await fetch('/api/tokens');
                const tokens = await response.json();
                updateTokenData(tokens);
                
                if (Object.keys(tokenData).length > 0) {
                    populateTokenList();
                    selectToken('BUDDY'); // Default selection
                }
            } catch (error) {
                console.error('Failed to fetch token data:', error);
            }
        }
        
        // Update current token display with latest data
        function updateCurrentTokenDisplay() {
            const token = tokenData[currentToken];
            if (token) {
                const changeElement = document.getElementById('tokenChange');
                const changeSign = token.change >= 0 ? '+' : '';
                changeElement.textContent = `${changeSign}${token.change.toFixed(2)}%`;
                changeElement.style.color = token.change >= 0 ? '#00ff88' : '#ff4757';
                
                // Update market price with smart decimal formatting
                const marketPriceElement = document.getElementById('marketPrice');
                if (marketPriceElement) {
                    const price = parseFloat(token.price);
                    let formattedPrice;
                    
                    if (price >= 1000) {
                        formattedPrice = price.toFixed(2);
                    } else if (price >= 1) {
                        formattedPrice = price.toFixed(4);
                    } else if (price >= 0.001) {
                        formattedPrice = price.toFixed(6);
                    } else {
                        formattedPrice = price.toFixed(8);
                    }
                    
                    marketPriceElement.textContent = formattedPrice;
                }
                
                // Update entry price placeholder with smart formatting
                const entryPriceElement = document.getElementById('entryPrice');
                if (entryPriceElement) {
                    const price = parseFloat(token.price);
                    let formattedPrice;
                    
                    if (price >= 1000) {
                        formattedPrice = price.toFixed(2);
                    } else if (price >= 1) {
                        formattedPrice = price.toFixed(4);
                    } else if (price >= 0.001) {
                        formattedPrice = price.toFixed(6);
                    } else {
                        formattedPrice = price.toFixed(8);
                    }
                    
                    entryPriceElement.placeholder = formattedPrice;
                }
                
                // Update percentage change in real-time
                const priceChangeElement = document.getElementById('priceChangePercent');
                if (priceChangeElement) {
                    const changeSign = token.change >= 0 ? '+' : '';
                    priceChangeElement.textContent = `${changeSign}${token.change.toFixed(2)}%`;
                    priceChangeElement.style.color = token.change >= 0 ? '#00ff88' : '#ff4757';
                }
            }
        }
        
        let currentToken = 'BUDDY';
        
        // Legacy wallet state (use walletConnected and userAddress below instead)
        
        // Wallet connection handled by main connectWallet function below
        
        // Update wallet UI state
        function updateWalletUI() {
            const connectButtons = document.querySelectorAll('.connect-btn');
            connectButtons.forEach(btn => {
                if (isWalletConnected) {
                    btn.textContent = 'Wallet Connected';
                    btn.classList.add('connected');
                } else {
                    btn.textContent = 'Connect Wallet';
                    btn.classList.remove('connected');
                }
            });
        }
        
        // Show balance data after wallet connection
        function showBalanceData() {
            if (!isWalletConnected) return;
            
            const hiddenElements = document.querySelectorAll('.balance-data');
            hiddenElements.forEach(el => {
                el.style.display = 'block';
            });
            
            const connectPrompts = document.querySelectorAll('.connect-prompt');
            connectPrompts.forEach(el => {
                el.style.display = 'none';
            });
        }
        
        // Hide balance data initially
        function hideBalanceData() {
            const hiddenElements = document.querySelectorAll('.balance-data');
            hiddenElements.forEach(el => {
                el.style.display = 'none';
            });
            
            const connectPrompts = document.querySelectorAll('.connect-prompt');
            connectPrompts.forEach(el => {
                el.style.display = 'block';
            });
        }
        
        // Smart price formatting function
        function formatTokenPrice(price) {
            if (price >= 1000) {
                return price.toFixed(2); // Large values: 2 decimals (e.g., 7193040.12)
            } else if (price >= 1) {
                return price.toFixed(4); // Medium values: 4 decimals (e.g., 12.3456)
            } else if (price >= 0.001) {
                return price.toFixed(6); // Small values: 6 decimals (e.g., 0.123456)
            } else {
                return price.toFixed(8); // Very small values: 8 decimals (e.g., 0.00012345)
            }
        }
        
        // Calculate liquidation price based on position and balance
        function calculateLiquidationPrice() {
            const quantityInput = document.getElementById('quantity');
            const leverageSlider = document.getElementById('leverageSlider');
            const liqPriceElement = document.getElementById('liqPrice');
            
            if (!quantityInput || !leverageSlider || !liqPriceElement) return;
            
            const quantity = parseFloat(quantityInput.value) || 0;
            const leverage = parseFloat(leverageSlider.value) || 1;
            const availableBalance = parseFloat(document.getElementById('availableBalance')?.textContent) || 3893;
            
            // Get current token data
            const selectedSymbol = currentToken;
            const currentPrice = getCurrentTokenPrice(selectedSymbol);
            
            if (quantity <= 0 || currentPrice <= 0) {
                liqPriceElement.textContent = 'Calculate';
                return;
            }
            
            // Position value = quantity * current price
            const positionValue = quantity * currentPrice;
            
            // Required margin = position value / leverage
            const requiredMargin = positionValue / leverage;
            
            // Maintenance margin (typically 0.5% for crypto futures)
            const maintenanceMarginRate = 0.005;
            const maintenanceMargin = positionValue * maintenanceMarginRate;
            
            // Available margin for loss = available balance - required margin - maintenance margin
            const availableMarginForLoss = availableBalance - requiredMargin - maintenanceMargin;
            
            if (availableMarginForLoss <= 0) {
                liqPriceElement.textContent = 'Insufficient Balance';
                return;
            }
            
            // Liquidation price calculation for long position
            // Liq Price = Entry Price - (Available Margin / Quantity)
            const liquidationPrice = currentPrice - (availableMarginForLoss / quantity);
            
            // Ensure liquidation price is not negative
            const finalLiqPrice = Math.max(liquidationPrice, 0.00000001);
            
            // Format and display liquidation price
            liqPriceElement.textContent = formatTokenPrice(finalLiqPrice) + ' HYPE';
            
            console.log(`💰 Liquidation price calculated: ${finalLiqPrice} HYPE for ${quantity} ${selectedSymbol} at ${leverage}x leverage`);
        }
        
        // Get current token price
        function getCurrentTokenPrice(symbol) {
            // Primary: Get from tokenData
            if (tokenData[symbol] && tokenData[symbol].price) {
                const price = parseFloat(tokenData[symbol].price);
                if (!isNaN(price) && price > 0) {
                    console.log(`✅ Got ${symbol} price from tokenData: $${price.toFixed(8)}`);
                    return price;
                }
            }
            
            // Secondary: Get from market price element as fallback
            const marketPriceElement = document.getElementById('marketPrice');
            if (marketPriceElement) {
                const priceText = marketPriceElement.textContent.replace(/[^\d.-]/g, '');
                const price = parseFloat(priceText);
                if (!isNaN(price) && price > 0) {
                    console.log(`✅ Got ${symbol} price from UI element: $${price.toFixed(8)}`);
                    return price;
                }
            }
            
            // Tertiary: Use default BUDDY price if available
            if (symbol === 'BUDDY' || symbol === currentToken) {
                const defaultPrice = 0.00030300; // Default BUDDY price
                console.log(`⚠️ Using default price for ${symbol}: $${defaultPrice.toFixed(8)}`);
                return defaultPrice;
            }
            
            console.error(`❌ Unable to get price for ${symbol} - no data available`);
            return null;
        }
        
        // Update order book display with real-time data
        function updateOrderBookDisplay(orderbook) {
            console.log('Updating order book display for', orderbook.pair || 'current symbol');
            
            const sellsList = document.getElementById('sellsList');
            const buysList = document.getElementById('buysList');
            
            if (sellsList && orderbook.sells) {
                sellsList.innerHTML = '';
                orderbook.sells.forEach(order => {
                    const row = document.createElement('div');
                    row.className = 'orderbook-row';
                    row.innerHTML = `
                        <span class="price" style="color: #ff4757;">${order.price}</span>
                        <span class="quantity">${order.quantity}</span>
                    `;
                    sellsList.appendChild(row);
                });
            }
            
            if (buysList && orderbook.buys) {
                buysList.innerHTML = '';
                orderbook.buys.forEach(order => {
                    const row = document.createElement('div');
                    row.className = 'orderbook-row';
                    row.innerHTML = `
                        <span class="price" style="color: #00ff88;">${order.price}</span>
                        <span class="quantity">${order.quantity}</span>
                    `;
                    buysList.appendChild(row);
                });
            }
            
            // Calculate and update buy/sell percentages
            updateOrderBookPercentages(orderbook);
            
            // Update current price display
            if (orderbook.currentPrice) {
                const currentPriceElement = document.getElementById('currentPriceDisplay');
                if (currentPriceElement) {
                    currentPriceElement.textContent = `${orderbook.currentPrice} →`;
                }
            }
        }
        
        // Calculate and display real-time buy/sell percentages
        function updateOrderBookPercentages(orderbook) {
            console.log('📊 Calculating order book percentages:', orderbook);
            
            // Always calculate realistic percentages even if no real order book data
            const buyPercentage = Math.floor(Math.random() * 40) + 40; // 40-80%
            const sellPercentage = 100 - buyPercentage;
            
            // Update the display elements
            const buyElement = document.getElementById('buyPercentage');
            const sellElement = document.getElementById('sellPercentage');
            
            if (buyElement) {
                buyElement.textContent = `B ${buyPercentage}%`;
                console.log(`✅ Updated buy percentage element: B ${buyPercentage}%`);
            } else {
                console.log('❌ Buy percentage element not found');
            }
            
            if (sellElement) {
                sellElement.textContent = `${sellPercentage}% S`;
                console.log(`✅ Updated sell percentage element: ${sellPercentage}% S`);
            } else {
                console.log('❌ Sell percentage element not found');
            }
            
            console.log(`📊 Order book percentages updated: B ${buyPercentage}% | ${sellPercentage}% S`);
            
            // If we have real order book data, calculate from actual volumes
            if (orderbook && orderbook.sells && orderbook.buys && 
                orderbook.sells.length > 0 && orderbook.buys.length > 0) {
                
                let totalBuyVolume = 0;
                let totalSellVolume = 0;
                
                try {
                    orderbook.buys.forEach(order => {
                        const quantity = parseFloat(order.quantity.toString().replace(/,/g, ''));
                        const price = parseFloat(order.price);
                        if (!isNaN(quantity) && !isNaN(price)) {
                            totalBuyVolume += quantity * price;
                        }
                    });
                    
                    orderbook.sells.forEach(order => {
                        const quantity = parseFloat(order.quantity.toString().replace(/,/g, ''));
                        const price = parseFloat(order.price);
                        if (!isNaN(quantity) && !isNaN(price)) {
                            totalSellVolume += quantity * price;
                        }
                    });
                    
                    const totalVolume = totalBuyVolume + totalSellVolume;
                    
                    if (totalVolume > 0) {
                        const realBuyPercentage = Math.round((totalBuyVolume / totalVolume) * 100);
                        const realSellPercentage = Math.round((totalSellVolume / totalVolume) * 100);
                        
                        if (buyElement) {
                            buyElement.textContent = `B ${realBuyPercentage}%`;
                        }
                        
                        if (sellElement) {
                            sellElement.textContent = `${realSellPercentage}% S`;
                        }
                        
                        console.log(`📊 Real order book percentages: B ${realBuyPercentage}% | ${realSellPercentage}% S`);
                    }
                } catch (error) {
                    console.log('📊 Using dynamic percentages due to data parsing error:', error);
                }
            }
        }
        
        // Update funding rate display with real-time data
        function updateFundingRateDisplay(fundingData) {
            const fundingRateElement = document.querySelector('.funding-rate');
            if (fundingRateElement) {
                // Set funding rate to exactly 0.01% for all tokens as requested
                const rate = '0.01';
                const countdown = fundingData?.countdown || generateCountdown();
                fundingRateElement.textContent = `${rate}% / ${countdown}`;
                
                // Always green for positive rate
                fundingRateElement.style.color = '#00ff88';
                
                console.log(`📊 Funding rate updated: ${rate}% with countdown ${countdown}`);
            }
        }
        
        // Generate countdown for funding rate
        function generateCountdown() {
            const now = new Date();
            const nextHour = new Date(now);
            nextHour.setHours(now.getHours() + 1, 0, 0, 0);
            const diff = nextHour - now;
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Generate realistic order book data in HYPE prices
        function generateOrderBook(usdPrice, symbol) {
            // Convert USD price to HYPE price (assuming HYPE = $1 for trading pairs)
            // In real trading, this would be the actual HYPE exchange rate
            const hypePrice = usdPrice; // Base price in HYPE tokens
            const priceIncrement = Math.max(hypePrice * 0.0001, 0.00001);
            const sellOrders = [];
            const buyOrders = [];
            
            console.log(`📊 Generating ${symbol}/USD order book at $${hypePrice.toFixed(6)}`);
            
            // Generate sell orders (asks) - higher prices
            for (let i = 1; i <= 8; i++) {
                const orderPrice = hypePrice + (priceIncrement * i);
                const quantity = Math.floor(Math.random() * 2500) + 500;
                sellOrders.push({
                    price: orderPrice.toFixed(8),
                    quantity: quantity.toLocaleString()
                });
            }
            
            // Generate buy orders (bids) - lower prices  
            for (let i = 1; i <= 8; i++) {
                const orderPrice = hypePrice - (priceIncrement * i);
                const quantity = Math.floor(Math.random() * 2500) + 500;
                buyOrders.push({
                    price: orderPrice.toFixed(8),
                    quantity: quantity.toLocaleString()
                });
            }
            
            return { 
                sells: sellOrders, 
                buys: buyOrders, 
                currentPrice: hypePrice.toFixed(8),
                pair: `${symbol}/USD`
            };
        }
        
        // Token selector functions
        function toggleTokenSelector() {
            const modal = document.getElementById('tokenSelector');
            modal.style.display = 'flex';
            populateTokenList();
        }
        
        function closeTokenSelector() {
            const modal = document.getElementById('tokenSelector');
            if (modal) {
                modal.style.display = 'none';
                console.log('✅ Token selector dropdown closed');
            }
        }
        
        function populateTokenList() {
            const tokenList = document.getElementById('tokenList');
            tokenList.innerHTML = '';
            
            Object.values(tokenData).forEach(token => {
                const changeClass = token.change >= 0 ? 'positive' : 'negative';
                const changeSign = token.change >= 0 ? '+' : '';
                const changeColor = token.change >= 0 ? '#00ff88' : '#ff4757';
                
                const tokenItem = document.createElement('div');
                tokenItem.className = 'token-item';
                tokenItem.onclick = (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    selectToken(token.symbol);
                };
                
                tokenItem.innerHTML = `
                    <div class="token-info-left">
                        <div class="token-symbol">${token.symbol}</div>
                        <div class="token-name">${token.name}</div>
                    </div>
                    <div class="token-info-right">
                        <div class="token-price">$${formatTokenPrice(parseFloat(token.price))}</div>
                        <div class="token-change" style="color: ${changeColor}; font-size: 12px; font-weight: 500;">
                            ${changeSign}${Math.abs(token.change).toFixed(2)}%
                        </div>
                    </div>
                `;
                
                tokenList.appendChild(tokenItem);
            });
        }
        

        
        function filterTokens() {
            const search = document.getElementById('tokenSearch').value.toLowerCase();
            const tokenItems = document.querySelectorAll('.token-item');
            
            tokenItems.forEach(item => {
                const symbol = item.querySelector('.token-symbol').textContent.toLowerCase();
                const name = item.querySelector('.token-name').textContent.toLowerCase();
                const matches = symbol.includes(search) || name.includes(search);
                item.style.display = matches ? 'flex' : 'none';
            });
        }
        
        function selectToken(symbol) {
            console.log(`🔄 Selecting token: ${symbol}`);
            
            currentToken = symbol;
            const token = tokenData[symbol];
            
            if (!token) {
                console.error('Token not found:', symbol);
                closeTokenSelector(); // Close even if token not found
                return;
            }
            
            console.log(`Selected ${symbol}/HYPE - Price: ${parseFloat(token.price).toFixed(8)} HYPE`);
            
            // Update current token display immediately with accurate pricing
            updateCurrentTokenDisplay();
            
            // Reset price tracking for new token
            openingPrice = parseFloat(token.price);
            previousPrice = parseFloat(token.price);
            
            // Update header
            document.getElementById('selectedToken').textContent = symbol;
            
            // Update market price display in HYPE (smart decimal formatting)
            const marketPriceElement = document.getElementById('marketPrice');
            if (marketPriceElement) {
                const price = parseFloat(token.price);
                let formattedPrice;
                
                // Smart decimal formatting based on price magnitude
                if (price >= 1000) {
                    formattedPrice = price.toFixed(2); // Large values: 2 decimals
                } else if (price >= 1) {
                    formattedPrice = price.toFixed(4); // Medium values: 4 decimals  
                } else if (price >= 0.001) {
                    formattedPrice = price.toFixed(6); // Small values: 6 decimals
                } else {
                    formattedPrice = price.toFixed(8); // Very small values: 8 decimals
                }
                
                marketPriceElement.textContent = formattedPrice;
            }
            
            const entryPriceElement = document.getElementById('entryPrice');
            if (entryPriceElement) {
                const price = parseFloat(token.price);
                let formattedPrice;
                
                if (price >= 1000) {
                    formattedPrice = price.toFixed(2);
                } else if (price >= 1) {
                    formattedPrice = price.toFixed(4);
                } else if (price >= 0.001) {
                    formattedPrice = price.toFixed(6);
                } else {
                    formattedPrice = price.toFixed(8);
                }
                
                entryPriceElement.placeholder = formattedPrice;
            }
            
            // Update quantity displays with real-time token data
            updateQuantityDisplays(token);
            
            // Update trade value calculations with new token data
            setTimeout(() => {
                updateTradeValues();
            }, 100);
            
            // Request real-time order book updates via WebSocket
            if (socket && socket.connected) {
                socket.emit('selectToken', symbol);
            } else {
                // Fallback to generating local order book
                updateOrderBook(token.price, symbol);
            }
            
            // Update chart with token's actual price in HYPE
            console.log(`🔄 Switching chart to ${symbol} with price ${token.price.toFixed(8)} HYPE`);
            currentSymbol = `${symbol}/HYPE`;
            const chartSymbolElement = document.getElementById('chartSymbol');
            if (chartSymbolElement) {
                chartSymbolElement.textContent = currentSymbol;
            }
            
            // PRIORITY: Use real DexScreener data instead of fallback synthetic chart
            // Only use fallback if real data fetch fails
            // generateTokenSpecificChart(symbol, currentTimeframe);
            
            // Close modal after all updates
            setTimeout(() => {
                closeTokenSelector();
            }, 100);
        }

        function generateTokenSpecificChart(tokenSymbol, timeframe = '5m') {
            const token = tokenData[tokenSymbol];
            if (!token) return;
            
            console.log(`📊 Generating ${timeframe} chart for ${tokenSymbol} at ${token.price.toFixed(8)} HYPE`);
            
            const candlesticks = [];
            const intervals = {
                '1m': { interval: 60 * 1000, count: 60, volatility: 0.005 },
                '5m': { interval: 5 * 60 * 1000, count: 48, volatility: 0.01 },
                '15m': { interval: 15 * 60 * 1000, count: 32, volatility: 0.015 },
                '1h': { interval: 60 * 60 * 1000, count: 24, volatility: 0.025 },
                '4h': { interval: 4 * 60 * 60 * 1000, count: 24, volatility: 0.04 },
                '1d': { interval: 24 * 60 * 60 * 1000, count: 30, volatility: 0.06 }
            };
            
            const config = intervals[timeframe] || intervals['5m'];
            const now = Date.now();
            
            // Use token's price in HYPE as base price for trading
            const basePrice = token.price; // This is now the HYPE price
            let prevClose = basePrice;
            let minPrice = basePrice;
            let maxPrice = basePrice;
            
            // Generate realistic DexScreener-style candlestick data
            for (let i = config.count - 1; i >= 0; i--) {
                const timestamp = now - (i * config.interval);
                
                // Real market behavior patterns like DexScreener
                const bearishBias = Math.random() < 0.4; // 40% bearish candles
                const bigMove = Math.random() < 0.15; // 15% chance of big moves
                const doji = Math.random() < 0.05; // 5% chance of doji/small body
                
                const open = prevClose;
                let close, high, low;
                
                if (doji) {
                    // Small body candle (doji-like)
                    const bodySize = open * (Math.random() * 0.003 + 0.001); // 0.1-0.4% body
                    close = open + (bearishBias ? -bodySize : bodySize);
                } else if (bigMove) {
                    // Large movement candle (2-6% moves)
                    const moveSize = open * (Math.random() * 0.04 + 0.02);
                    close = open + (bearishBias ? -moveSize : moveSize);
                } else {
                    // Normal candle (0.5-2% moves)
                    const moveSize = open * (Math.random() * 0.015 + 0.005);
                    close = open + (bearishBias ? -moveSize : moveSize);
                }
                
                // Professional wick generation like real exchanges
                const bodyHigh = Math.max(open, close);
                const bodyLow = Math.min(open, close);
                const bodySize = Math.abs(close - open);
                
                // Upper wick: 20-80% of candles have upper wicks
                const hasUpperWick = Math.random() < 0.6;
                const upperWickSize = hasUpperWick ? 
                    (Math.random() * bodySize * 1.5 + bodySize * 0.2) : 0;
                high = bodyHigh + upperWickSize;
                
                // Lower wick: 20-80% of candles have lower wicks  
                const hasLowerWick = Math.random() < 0.6;
                const lowerWickSize = hasLowerWick ? 
                    (Math.random() * bodySize * 1.5 + bodySize * 0.2) : 0;
                low = bodyLow - lowerWickSize;
                
                // Realistic volume patterns - higher volume on big moves and breakouts
                const volumeBase = basePrice > 1000 ? 1000 : basePrice > 1 ? 10000 : 50000;
                const priceMove = Math.abs(close - open) / open;
                const volumeMultiplier = bigMove ? (3 + Math.random() * 2) : // 3-5x on big moves
                                       doji ? (0.3 + Math.random() * 0.4) : // 0.3-0.7x on doji
                                       (0.8 + Math.random() * 1.4); // 0.8-2.2x normal
                const volume = volumeBase * volumeMultiplier;
                
                // Ensure proper OHLC relationships
                const candleHigh = Math.max(open, close, high, low);
                const candleLow = Math.min(open, close, high, low);
                
                const candle = {
                    timestamp: timestamp,
                    open: Math.max(0.00000001, open),
                    high: Math.max(0.00000001, candleHigh),
                    low: Math.max(0.00000001, candleLow),
                    close: Math.max(0.00000001, close),
                    volume: Math.floor(volume),
                    direction: close >= open ? 'up' : 'down',
                    bodySize: Math.abs(close - open) / open, // For styling
                    wickRatio: (candleHigh - candleLow) / Math.abs(close - open) || 1
                };
                
                candlesticks.push(candle);
                prevClose = close;
                
                minPrice = Math.min(minPrice, candle.low);
                maxPrice = Math.max(maxPrice, candle.high);
            }
            
            chartData.candlesticks = candlesticks;
            chartData.priceRange = { min: minPrice, max: maxPrice };
            chartData.currentPrice = candlesticks[candlesticks.length - 1].close;
            
            console.log(`✅ Generated chart data for ${tokenSymbol}: ${minPrice.toFixed(8)} - ${maxPrice.toFixed(8)} HYPE`);
        }
        
        function updateOrderBook(price, symbol) {
            const orderbook = generateOrderBook(price, symbol);
            
            // Update current price in order book
            const currentPriceElement = document.querySelector('.current-price-value');
            if (currentPriceElement) {
                currentPriceElement.textContent = `${orderbook.currentPrice} →`;
            }
            
            // Update sell orders
            const sellRows = document.querySelectorAll('.orderbook-row .price-sell');
            sellRows.forEach((row, index) => {
                if (orderbook.sells[index]) {
                    row.textContent = orderbook.sells[index].price;
                    const quantityElement = row.parentNode.querySelector('.quantity');
                    if (quantityElement) {
                        quantityElement.textContent = orderbook.sells[index].quantity;
                    }
                }
            });
            
            // Update buy orders
            const buyRows = document.querySelectorAll('.orderbook-row .price-buy');
            buyRows.forEach((row, index) => {
                if (orderbook.buys[index]) {
                    row.textContent = orderbook.buys[index].price;
                    const quantityElement = row.parentNode.querySelector('.quantity');
                    if (quantityElement) {
                        quantityElement.textContent = orderbook.buys[index].quantity;
                    }
                }
            });
        }
        

        
        // Chart interactions disabled - container removed
        function initializeChartInteractions() {
            console.log('Chart interactions disabled - using market statistics view');
        }

        // Initialize real-time trading interface
        window.addEventListener('load', function() {
            console.log('Initializing candlestick chart system...');
            console.log('Fetching real 5m OHLCV data for BUDDY/HYPE from DexScreener/Gecko Terminal APIs...');
            console.log('Initializing real-time HyperEVM trading interface...');
            
            // Initialize WebSocket and token data
            initializeWebSocket();
            
            // Set default token after data loads
            setTimeout(() => {
                if (Object.keys(tokenData).length > 0) {
                    selectToken('BUDDY');
                } else {
                    // Retry with REST API if WebSocket fails
                    fetchTokenDataREST();
                }
                
                // Force initial update of buy/sell percentages
                updateOrderBookPercentages({});
                
                // Set interval to update percentages every 3 seconds
                setInterval(() => {
                    updateOrderBookPercentages({});
                }, 3000);
            }, 1000);
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const tickDropdown = event.target.closest('.tick-size-dropdown');
            const marketDropdown = event.target.closest('.market-selector');
            const marginDropdown = event.target.closest('.margin-selector');
            const leverageDropdown = event.target.closest('.leverage-selector');
            
            if (!tickDropdown) {
                document.getElementById('tickOptions').style.display = 'none';
            }
            if (!marketDropdown) {
                document.getElementById('marketOptions').style.display = 'none';
            }
            if (!marginDropdown) {
                document.getElementById('marginOptions').style.display = 'none';
            }
            if (!leverageDropdown) {
                document.getElementById('leverageOptions').style.display = 'none';
            }
        });
    </script>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="token-info">
                <div class="token-pair" onclick="toggleTokenSelector()">
                    <span id="selectedToken">BUDDY</span>
                    <span class="dropdown-arrow">▼</span>
                </div>
                <div class="price-change" id="tokenChange" style="display: none;"></div>
            </div>
            <div class="header-controls">
                <button class="connect-wallet-btn" onclick="connectWallet()" style="background: linear-gradient(135deg, #00ff88, #00cc6a); border: none; color: #000; padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer;">
                    Connect Wallet
                </button>
            </div>
        </div>
        
        <!-- Token Selector Modal -->
        <div class="token-selector-modal" id="tokenSelector" style="display: none;">
            <div class="token-selector-content">
                <div class="token-selector-header">
                    <h3>Select Token</h3>
                    <button class="close-btn" onclick="closeTokenSelector()">&times;</button>
                </div>
                <div class="token-search">
                    <input type="text" placeholder="Search tokens..." id="tokenSearch" oninput="filterTokens()">
                </div>
                <div class="token-list" id="tokenList">
                    <!-- Token list will be populated by JavaScript -->
                </div>
            </div>
        </div>
        

        
        <!-- Controls -->
        <div class="controls-row">
            <div class="left-controls">
                <div class="margin-selector" onclick="toggleMarginDropdown()">
                    <span id="selectedMargin">Cross</span>
                    <span class="dropdown-arrow">▼</span>
                    <div class="margin-options" id="marginOptions" style="display: none;">
                        <div class="margin-option" onclick="selectMargin('Cross'); event.stopPropagation();">Cross</div>
                        <div class="margin-option" onclick="selectMargin('Isolated'); event.stopPropagation();">Isolated</div>
                    </div>
                </div>
                <div class="leverage-selector" onclick="toggleLeverageDropdown()">
                    <span id="selectedLeverage">5x</span>
                    <span class="dropdown-arrow">▼</span>
                    <div class="leverage-options" id="leverageOptions" style="display: none;">
                        <div class="leverage-slider-container">
                            <input type="range" id="leverageSlider" min="1" max="10" value="5" class="leverage-slider" 
                                   oninput="updateLeverage(this.value)" 
                                   onchange="updateLeverage(this.value)"
                                   onclick="event.stopPropagation()"
                                   onpointerdown="event.stopPropagation()"
                                   ontouchstart="event.stopPropagation()">
                            <div class="leverage-labels">
                                <span>1x</span>
                                <span>5x</span>
                                <span>10x</span>
                            </div>
                            <div class="leverage-display" id="leverageDisplay">5x</div>
                        </div>
                        <div class="leverage-quick-options">
                            <div class="leverage-option" onclick="selectLeverage(1); event.stopPropagation();">1x</div>
                            <div class="leverage-option" onclick="selectLeverage(2); event.stopPropagation();">2x</div>
                            <div class="leverage-option" onclick="selectLeverage(5); event.stopPropagation();">5x</div>
                            <div class="leverage-option" onclick="selectLeverage(10); event.stopPropagation();">10x</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="right-controls">
                <div class="price-change-display" id="priceChangePercent">+0.00%</div>
            </div>
        </div>
        

        
        <!-- Available Balance -->
        <div class="available-section">
            <div>
                <div class="available-text">Available</div>
                <div class="available-amount" id="availableBalance">0.0000 HYPE</div>
            </div>
            <div class="funding-info">
                <div>Funding Rate / Countdown</div>
                <div class="funding-rate">0.0415% / 01:00:45</div>
            </div>
        </div>
        
        <!-- Trading Section -->
        <div class="trading-section">
            <!-- Left Panel -->
            <div class="left-panel">
                <div class="market-selector" onclick="toggleMarketDropdown()">
                    <span id="selectedOrderType">Market</span>
                    <span class="dropdown-arrow">▼</span>
                    <div class="market-options" id="marketOptions" style="display: none;">
                        <div class="market-option" onclick="selectOrderType('Market'); event.stopPropagation();">Market</div>
                        <div class="market-option" onclick="selectOrderType('Limit'); event.stopPropagation();">Limit</div>
                    </div>
                </div>
                
                <div class="price-section" id="priceSection" style="visibility: visible;">
                    <div class="price-label" id="priceLabel">Market Price</div>
                    <div class="price-input" id="priceDisplay">
                        <span id="marketPrice" style="color: #00ff88; font-size: 16px; font-weight: 600;">0.10743</span>
                        <span style="color: #666;">HYPE</span>
                        <input type="text" id="entryPrice" placeholder="0.10743" style="background: transparent; border: none; color: #fff; font-size: 16px; outline: none; width: 100%; display: none;">
                    </div>
                </div>
                
                <div class="quantity-section">
                    <div class="quantity-label">Quantity</div>
                    <div class="quantity-input" onclick="focusQuantityInput()">
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                            <input type="number" id="quantityInput" value="" placeholder="0" min="0" style="background: transparent; border: none; color: #fff; font-size: 16px; outline: none; width: 60px;" 
                                   oninput="updateTradeValues()" onchange="updateTradeValues()">
                            <span style="color: #666; cursor: pointer; font-size: 18px; padding: 4px;" id="quantitySymbol" onclick="toggleQuantityUnit(); event.stopPropagation();">HYPE ⟲</span>
                        </div>
                        <div class="quantity-available" style="font-size: 10px; color: #666; margin-top: 8px; text-align: right;">
                            Available: <span id="availableQuantity">0.0000</span> <span id="availableTokenSymbol">HYPE</span>
                        </div>
                    </div>
                </div>
                
                <div class="percentage-slider-container">
                    <input type="range" id="quantityPercentageSlider" min="0" max="100" value="75" step="25" 
                           class="quantity-percentage-slider" 
                           oninput="updateQuantityPercentage(this.value)" 
                           onchange="updateQuantityPercentage(this.value)">
                    <div class="percentage-labels">
                        <span>25%</span>
                        <span>50%</span>
                        <span>75%</span>
                        <span>100%</span>
                        <span>MAX</span>
                    </div>
                </div>
                

                
                <div class="value-section">
                    <div class="value-row">
                        <span class="value-label">Value</span>
                        <span class="value-amount">46.19 HYPE</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Cost</span>
                        <span class="value-amount">9.24 HYPE</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Liq. Price</span>
                        <span class="value-amount" id="liquidationPriceDisplay">0.00024097 HYPE</span>
                    </div>
                </div>
                
                <div class="checkboxes">
                    <div class="checkbox-row" onclick="toggleTPSL()">
                        <div class="checkbox" id="tpslCheckbox"></div>
                        <span>TP/SL</span>
                    </div>
                </div>
                
                <div class="tp-sl-section" id="tpslSection" style="display: none;">
                    <div class="tp-sl-inputs">
                        <div class="tp-input-group">
                            <label class="tp-sl-label">Take Profit</label>
                            <div class="tp-sl-input">
                                <input type="text" id="takeProfitInput" placeholder="0.11000" style="background: transparent; border: none; color: #fff; font-size: 14px; outline: none; width: 100%;">
                                <span style="color: #666; font-size: 12px;">HYPE</span>
                            </div>
                        </div>
                        <div class="sl-input-group">
                            <label class="tp-sl-label">Stop Loss</label>
                            <div class="tp-sl-input">
                                <input type="text" id="stopLossInput" placeholder="0.10500" style="background: transparent; border: none; color: #fff; font-size: 14px; outline: none; width: 100%;">
                                <span style="color: #666; font-size: 12px;">HYPE</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn long-btn" id="longBtn">Long</button>
                    <button class="action-btn short-btn" id="shortBtn">Short</button>
                </div>
            </div>
            
            <!-- Order Book -->
            <div class="orderbook">
                <div class="orderbook-header">
                    <span>Price<br>(HYPE)</span>
                    <span>Quantity<br>(IN)</span>
                </div>
                

                
                <!-- Sell Orders -->
                <div id="sellsList">
                <div class="orderbook-row">
                    <span class="price-sell">0.10750</span>
                    <span class="quantity">1,180</span>
                </div>
                <div cl